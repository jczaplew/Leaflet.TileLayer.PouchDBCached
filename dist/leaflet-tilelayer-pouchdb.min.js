function asyncEach(t,n,e){function o(){return i++,i===r?void e():void n(t[i],o)}var i=-1,r=t.length;o()}!function t(n,e,o){function i(a,s){if(!e[a]){if(!n[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=e[a]={exports:{}};n[a][0].call(h.exports,function(t){var e=n[a][1][t];return i(e?e:t)},h,h.exports,t,n,e,o)}return e[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(t,n,e){(function(n){function o(t){return{type:"Feature",geometry:f.tileToGeoJSON(t),properties:{}}}function i(t,n){var e,o,i=t.coordinates,s=n.max_zoom,c={},d=[];if("Point"===t.type)return[f.pointToTile(i[0],i[1],s)];if("MultiPoint"===t.type)for(e=0;e<i.length;e++)o=f.pointToTile(i[e][0],i[e][1],s),c[h(o[0],o[1],o[2])]=!0;else if("LineString"===t.type)l(c,i,s);else if("MultiLineString"===t.type)for(e=0;e<i.length;e++)l(c,i[e],s);else if("Polygon"===t.type)a(c,d,i,s);else{if("MultiPolygon"!==t.type)throw new Error("Geometry type not implemented");for(e=0;e<i.length;e++)a(c,d,i[e],s)}if(n.min_zoom!==s){var p=d.length;for(u(c,d),e=0;p>e;e++){var v=d[e];c[h(v[0],v[1],v[2])]=!0}return r(c,d,n)}return u(c,d),d}function r(t,n,e){for(var o=[],i=e.max_zoom;i>e.min_zoom;i--){for(var r={},a=[],s=0;s<n.length;s++){var l=n[s];if(l[0]%2===0&&l[1]%2===0){var u=h(l[0]+1,l[1],i),c=h(l[0],l[1]+1,i),f=h(l[0]+1,l[1]+1,i);if(t[u]&&t[c]&&t[f]){t[h(l[0],l[1],l[2])]=!1,t[u]=!1,t[c]=!1,t[f]=!1;var d=[l[0]/2,l[1]/2,i-1];i-1===e.min_zoom?o.push(d):(r[h(l[0]/2,l[1]/2,i-1)]=!0,a.push(d))}}}for(s=0;s<n.length;s++)l=n[s],t[h(l[0],l[1],l[2])]&&o.push(l);t=r,n=a}return o}function a(t,n,e,o){for(var i=[],r=0;r<e.length;r++){var a=[];l(t,e[r],o,a);for(var u=0,c=a.length,f=c-1;c>u;f=u++){var d=(u+1)%c,p=a[u][1];(p>a[f][1]||p>a[d][1])&&(p<a[f][1]||p<a[d][1])&&p!==a[d][1]&&i.push(a[u])}}for(i.sort(s),r=0;r<i.length;r+=2){p=i[r][1];for(var v=i[r][0]+1;v<i[r+1][0];v++){var g=h(v,p,o);t[g]||n.push([v,p,o])}}}function s(t,n){return t[1]-n[1]||t[0]-n[0]}function l(t,n,e,o){for(var i,r,a=0;a<n.length-1;a++){var s=f.pointToTileFraction(n[a][0],n[a][1],e),l=f.pointToTileFraction(n[a+1][0],n[a+1][1],e),u=s[0],c=s[1],d=l[0],p=l[1],v=d-u,g=p-c;if(0!==g||0!==v){var m=v>0?1:-1,y=g>0?1:-1,_=Math.floor(u),b=Math.floor(c),T=0===v?1/0:Math.abs(((v>0?1:0)+_-u)/v),L=0===g?1/0:Math.abs(((g>0?1:0)+b-c)/g),M=Math.abs(m/v),O=Math.abs(y/g);for((_!==i||b!==r)&&(t[h(_,b,e)]=!0,o&&b!==r&&o.push([_,b]),i=_,r=b);1>T||1>L;)L>T?(T+=M,_+=m):(L+=O,b+=y),t[h(_,b,e)]=!0,o&&b!==r&&o.push([_,b]),i=_,r=b}}o&&b===o[0][1]&&o.pop()}function u(t,n){for(var e=Object.keys(t),o=0;o<e.length;o++)n.push(c(+e[o]))}function h(t,n,e){var o=2*(1<<e);return 32*(o*n+t)+e}function c(t){var n=t%32,e=2*(1<<n),o=(t-n)/32,i=o%e,r=(o-i)/e%e;return[i,r,n]}var f=t("tilebelt");e.geojson=function(t,n){return{type:"FeatureCollection",features:i(t,n).map(o)}},e.tiles=i,n.tileCover=i,e.indexes=function(t,n){return i(t,n).map(f.tileToQuadkey)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{tilebelt:2}],2:[function(t,n,e){function o(t){var n=r(t[0]+1,t[2]),e=r(t[0],t[2]),o=a(t[1]+1,t[2]),i=a(t[1],t[2]);return[e,o,n,i]}function i(t){var n=o(t),e={type:"Polygon",coordinates:[[[n[0],n[1]],[n[0],n[3]],[n[2],n[3]],[n[2],n[1]],[n[0],n[1]]]]};return e}function r(t,n){return t/Math.pow(2,n)*360-180}function a(t,n){var e=Math.PI-2*Math.PI*t/Math.pow(2,n);return b*Math.atan(.5*(Math.exp(e)-Math.exp(-e)))}function s(t,n,e){var o=y(t,n,e);return o[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),o}function l(t){return[[2*t[0],2*t[1],t[2]+1],[2*t[0]+1,2*t[1],t[2]+1],[2*t[0]+1,2*t[1]+1,t[2]+1],[2*t[0],2*t[1]+1,t[2]+1]]}function u(t){return t[0]%2===0&&t[1]%2===0?[t[0]/2,t[1]/2,t[2]-1]:t[0]%2===0&&!t[1]%2===0?[t[0]/2,(t[1]-1)/2,t[2]-1]:!t[0]%2===0&&t[1]%2===0?[(t[0]-1)/2,t[1]/2,t[2]-1]:[(t[0]-1)/2,(t[1]-1)/2,t[2]-1]}function h(t){return l(u(t))}function c(t,n){for(var e=h(t),o=0;o<e.length;o++)if(!f(n,e[o]))return!1;return!0}function f(t,n){for(var e=0;e<t.length;e++)if(d(t[e],n))return!0;return!1}function d(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function p(t){for(var n="",e=t[2];e>0;e--){var o=0,i=1<<e-1;0!==(t[0]&i)&&o++,0!==(t[1]&i)&&(o+=2),n+=o.toString()}return n}function v(t){for(var n=0,e=0,o=t.length,i=o;i>0;i--){var r=1<<i-1;switch(t[o-i]){case"0":break;case"1":n|=r;break;case"2":e|=r;break;case"3":n|=r,e|=r}}return[n,e,o]}function g(t){var n=s(t[0],t[1],32),e=s(t[2],t[3],32),o=[n[0],n[1],e[0],e[1]],i=m(o);if(0===i)return[0,0,0];var r=o[0]>>>32-i,a=o[1]>>>32-i;return[r,a,i]}function m(t){for(var n=28,e=0;n>e;e++){var o=1<<32-(e+1);if((t[0]&o)!=(t[2]&o)||(t[1]&o)!=(t[3]&o))return e}return n}function y(t,n,e){var o=Math.sin(n*_),i=Math.pow(2,e),r=i*(t/360+.5),a=i*(.5-.25*Math.log((1+o)/(1-o))/Math.PI);return[r,a,e]}var _=Math.PI/180,b=180/Math.PI;n.exports={tileToGeoJSON:i,tileToBBOX:o,getChildren:l,getParent:u,getSiblings:h,hasTile:f,hasSiblings:c,tilesEqual:d,tileToQuadkey:p,quadkeyToTile:v,pointToTile:s,bboxToTile:g,pointToTileFraction:y}},{}]},{},[1]),L.TileLayer.addInitHook(function(){return this.options.useCache?(this._db=new PouchDB("offline-tiles"),this._canvas=document.createElement("canvas"),void(this._canvas.getContext&&this._canvas.getContext("2d")||(this._canvas=null))):(this._db=null,void(this._canvas=null))}),L.TileLayer.prototype.options.useCache=!1,L.TileLayer.prototype.options.useOnlyCache=!1,L.TileLayer.prototype.options.cacheMaxAge=864e5,L.TileLayer.include({createTile:function(t,n){var e=document.createElement("img");e.onerror=L.bind(this._tileOnError,this,n,e),this.options.crossOrigin&&(e.crossOrigin=""),e.alt="";var o=this.getTileUrl(t);return this.options.useCache&&this._canvas?this._db.get(o,{revs_info:!0},this._onCacheLookup(e,o,n)):e.onload=L.bind(this._tileOnLoad,this,n,e),e.src=o,e},_onCacheLookup:function(t,n,e){return function(o,i){i?(this.fire("tilecache-hit",{tile:t,url:n}),Date.now()>i.timestamp+this.options.cacheMaxAge&&!this.options.useOnlyCache?(t.crossOrigin="Anonymous",t.src=n,t.onload=L.bind(this._tileOnLoad,this,e,t),t.onerror=function(t){this.src=i.dataUrl}):(t.onload=L.bind(this._tileOnLoad,this,e,t),t.src=i.dataUrl)):(this.fire("tilecache-miss",{tile:t,url:n}),this.options.useOnlyCache?(t.onload=this._tileOnLoad,t.src=L.Util.emptyImageUrl):(t.onload=L.bind(this._tileOnLoad,this,e,t),t.crossOrigin="Anonymous",t.src=n))}.bind(this)},URI2Base64:function(t,n){var e=new Image;e.crossOrigin="Anonymous",e.onload=function(){var t,e=document.createElement("canvas"),o=e.getContext("2d");e.height=this.height,e.width=this.width,o.drawImage(this,0,0),t=e.toDataURL("image/png",1),n(t),e=null},e.src=t},seed:function(t,n,e){if(!(n>e)&&this._map){this.fire("tilecache-load-start",{bbox:t,minZoom:n,maxZoom:e});for(var o={type:"Polygon",coordinates:[[[t._southWest.lng,t._southWest.lat],[t._southWest.lng,t._northEast.lat],[t._northEast.lng,t._northEast.lat],[t._northEast.lng,t._southWest.lat],[t._southWest.lng,t._southWest.lat]]]},i=[],r=n;e+1>r;r++)i=i.concat(tileCover(o,{min_zoom:r,max_zoom:r}));this._seedTiles(i)}},_seedTiles:function(t){var n=this._url,e=0;asyncEach(t,function(o,i){var r=n.replace("{x}",o[0]).replace("{y}",o[1]).replace("{z}",o[2]);this._db.get(r,function(n,o){o?i(null):this.URI2Base64(r,function(n){var o=Date.now();this._db.put({dataUrl:n,timestamp:o},r,o),e+=1,this.fire("tilecache-load-progress",{done:e,total:t.length}),i(null)}.bind(this))}.bind(this))}.bind(this),function(){this.fire("tilecache-load-done",!0)}.bind(this))},clearCache:function(){this._db.destroy().then(function(){this._db=new PouchDB("offline-tiles")}.bind(this))}});